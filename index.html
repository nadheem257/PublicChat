
<!DOCTYPE html>
<html>
<head>
<title>Super Chat</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{margin:0;font-family:Arial;background:#0a0f14;color:#fff;display:flex;flex-direction:column;height:100vh;}
header{padding:15px;background:#111;border-bottom:1px solid #222;font-size:18px;font-weight:bold;display:flex;justify-content:space-between;align-items:center;}
#roomsList{padding:10px;background:#0e131a;border-right:1px solid #222;width:200px;overflow-y:auto;display:none;flex-shrink:0;}
#chatArea{flex:1;display:flex;flex-direction:column;}
#messages{flex:1;padding:10px;overflow-y:auto;}
.msg{max-width:70%;margin:6px;padding:10px;border-radius:10px;display:inline-block;}
.me{background:#1f8ef1;margin-left:auto;border-bottom-right-radius:0;}
.them{background:#2c2f33;border-bottom-left-radius:0;}
#inputBar{padding:10px;display:flex;gap:10px;background:#111;}
#inputText{flex:1;padding:10px;border:none;border-radius:8px;font-size:16px;}
button{padding:10px;border:none;border-radius:8px;background:#1f8ef1;color:white;font-size:14px;cursor:pointer;transition:.2s;}
button:hover{opacity:0.8;}
.roomButton{width:100%;background:#131b26;padding:12px;margin-bottom:6px;border-radius:8px;text-align:left;}
.activeRoom{background:#1f8ef1;}
#homeScreen{position:fixed;top:0;left:0;width:100%;height:100%;background:#0a0f14;display:flex;flex-direction:column;justify-content:center;align-items:center;z-index:5;}
#homeScreen input{padding:10px;width:60%;margin-top:10px;border-radius:6px;border:none;}
.hidden{display:none;}
</style>
</head>

<body>

<!-- LOGIN SCREEN -->
<div id="homeScreen">
    <h2>Super Chat</h2>
    <input type="text" id="usernameInput" placeholder="Enter your name">
    <br>
    <button onclick="enterChat()">Enter Chat</button>
</div>

<header>
    <span id="roomName">Public Chat</span>
    <button onclick="toggleRooms()">Rooms</button>
</header>

<div style="display:flex;flex:1;">
    <div id="roomsList"></div>

    <div id="chatArea">
        <div id="messages"></div>

        <div id="inputBar">
            <button onclick="startSelect()">Select</button>
            <input id="inputText" placeholder="Type a message..." onkeydown="if(event.key==='Enter')sendMsg()">
            <button onclick="sendMsg()">Send</button>
        </div>
    </div>
</div>


<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

<script>
// ðŸ”¥ Replace with your Firebase config
const firebaseConfig = {
  apiKey: "YOUR_KEY",
  authDomain: "YOUR_APP.firebaseapp.com",
  databaseURL: "https://YOUR_APP-default-rtdb.firebaseio.com",
  projectId: "YOUR_APP",
  storageBucket: "YOUR_APP.appspot.com",
  messagingSenderId: "ID",
  appId: "APP_ID"
};
firebase.initializeApp(firebaseConfig);

let db = firebase.database();

let username = "";
let currentRoom = "Public";
let selecting = false;
let selectedMessages = [];

// âœ… Enter Chat
function enterChat(){
    username = document.getElementById("usernameInput").value.trim();
    if(!username){alert("Enter a name!");return;}

    document.getElementById("homeScreen").classList.add("hidden");
    loadRooms();
    joinRoom("Public");
}

// âœ… Room UI
function toggleRooms(){
    let rl = document.getElementById("roomsList");
    rl.style.display = rl.style.display==="block" ? "none" : "block";
}

// âœ… Load Rooms
function loadRooms(){
    let box = document.getElementById("roomsList");
    box.innerHTML = "";
    box.innerHTML += `<button class="roomButton" onclick="newRoomPrompt()">+ Create Group</button>`;

    db.ref("rooms").once("value", snap=>{
        snap.forEach(r=>{
            let name = r.key;
            box.innerHTML += `<button class="roomButton" onclick="joinRoom('${name}')">${name}</button>`;
        });
    });
}

// âœ… Create Room
function newRoomPrompt(){
    let name = prompt("Group name?");
    if(!name) return;
    db.ref("rooms/"+name).set(true);
    loadRooms();
}

// âœ… Join Room
function joinRoom(room){
    currentRoom = room;
    document.getElementById("roomName").innerText = room;
    document.getElementById("messages").innerHTML = "";
    loadRooms();
    fetchMessages();
}

// âœ… Load messages
function fetchMessages(){
    db.ref("messages/"+currentRoom).off();
    db.ref("messages/"+currentRoom).on("child_added", s=>{
        let data = s.val();
        displayMessage(data.id, data.user, data.text);
    });
}

// âœ… Display message bubble
function displayMessage(id,user,text){
    let div = document.createElement("div");
    div.className = user===username ? "msg me" : "msg them";
    div.innerText = `${user}: ${text}`;
    
    if(selecting){
        div.onclick = ()=>toggleSelect(id,div);
    }

    document.getElementById("messages").appendChild(div);
    document.getElementById("messages").scrollTop = 9999999;
}

// âœ… Toggle message select
function toggleSelect(id,element){
    if(selectedMessages.includes(id)){
        selectedMessages = selectedMessages.filter(x=>x!==id);
        element.style.border="none";
    } else {
        selectedMessages.push(id);
        element.style.border="2px solid red";
    }
}

// âœ… Start selecting
function startSelect(){
    selecting = !selecting;
    alert(selecting ? "Tap messages to select & delete" : "Select mode off");
    if(!selecting) deleteSelected();
}

// âœ… Delete selected
function deleteSelected(){
    selectedMessages.forEach(id=>{
        db.ref("messages/"+currentRoom+"/"+id).remove();
    });
    selectedMessages=[];
}

// âœ… Send message
function sendMsg(){
    let t = inputText.value.trim();
    if(!t) return;

    let id = Date.now();
    db.ref("messages/"+currentRoom+"/"+id).set({
        id:id,
        user:username,
        text:t
    });

    inputText.value="";
}
</script>

</body>
</html>
