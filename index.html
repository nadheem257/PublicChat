<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Cool WhatsApp-Style Chat</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/emojionearea/3.4.1/emojionearea.min.css"/>
<style>
body {margin:0;font-family:'Roboto',sans-serif;background:#ece5dd;display:flex;justify-content:center;align-items:center;height:100vh;overflow:hidden;}
#chatApp {display:none;width:95%;max-width:1200px;height:85%;background:#fff;border-radius:10px;box-shadow:0 5px 15px rgba(0,0,0,0.2);overflow:hidden;}

/* Home Page */
#homePage {position:absolute;top:0;left:0;width:100%;height:100%;background:#075e54;display:flex;flex-direction:column;justify-content:center;align-items:center;color:white;}
#homePage input, #homePage button {padding:12px; font-size:18px; border-radius:25px; border:none; margin-bottom:10px; width:250px;}
#homePage button {background:#128c7e; color:white; cursor:pointer;}
#homePage button:hover {background:#0af;}

/* Sidebar & Buttons */
#leftSidebar, #rightSidebar {width:250px;background:#ededed;display:flex;flex-direction:column;overflow:hidden;}
#leftSidebar {border-right:1px solid #ccc;}
#rightSidebar {border-left:1px solid #ccc;}
#leftSidebar h2, #rightSidebar h2 {text-align:center; margin:10px;}
#rooms {flex:1;overflow-y:auto;padding:5px;}
.room, #createGroupBtn, #deleteAllBtn, #selectBtn, #deleteSelectedBtn, #sendBtn, #emojiBtn, #attachBtn {border:none;border-radius:25px;background:#075e54;color:white;cursor:pointer;font-size:16px;margin:5px;padding:10px;}
.room:hover, #createGroupBtn:hover, #deleteAllBtn:hover, #selectBtn:hover, #deleteSelectedBtn:hover, #sendBtn:hover, #emojiBtn:hover, #attachBtn:hover {background:#128c7e;}
.room.active {background:#075e54;color:white;font-weight:bold;}

/* Chat area */
#chatArea {flex:1;display:flex;flex-direction:column;background:#f0f0f0;}
#chatHeader {padding:15px;background:#075e54;color:white;font-size:22px;display:flex;justify-content:space-between;align-items:center;}
#chatMessages {flex:1;padding:15px;overflow-y:auto;display:flex;flex-direction:column;}
.bubble {max-width:60%;padding:12px 18px;margin:5px 0;border-radius:20px;word-wrap: break-word;font-size:16px;position: relative; cursor:pointer;}
.bubble-you {background:#dcf8c6;align-self:flex-end;border-bottom-right-radius:0;color:#000;}
.bubble-friend {background:#fff;align-self:flex-start;border-bottom-left-radius:0;color:#000;}
.bubble.selected {border:2px solid red;}
#chatInput {display:flex;padding:10px;background:#eee;border-top:1px solid #ccc;align-items:center;}
#chatInput input[type="text"] {flex:1;padding:12px 15px;border-radius:25px;border:none;font-size:16px;margin-right:10px;}
img.chat-image {max-width:200px;border-radius:15px;margin-top:5px; cursor:pointer;}
</style>
</head>
<body>

<!-- Home Page -->
<div id="homePage">
    <h1>Welcome to Cool Chat!</h1>
    <input type="text" id="nameInputHome" placeholder="Enter your name...">
    <button id="enterChatBtn">Enter Chat</button>
</div>

<div id="chatApp">
    <div id="leftSidebar">
        <h2>Rooms</h2>
        <button class="room active" data-room="room1">Public Temporary Chat</button>
        <button id="createGroupBtn">+ Create Group</button>
        <div id="rooms"></div>
    </div>

    <div id="chatArea">
        <div id="chatHeader">
            <span id="chatTitle">Public Temporary Chat</span>
            <div>
                <button id="deleteAllBtn">Delete All</button>
                <button id="selectBtn">Select</button>
                <button id="deleteSelectedBtn" style="display:none;">Delete Selected</button>
            </div>
        </div>
        <div id="chatMessages"></div>
        <div id="chatInput">
            <button id="attachBtn">ðŸ“Ž</button>
            <button id="emojiBtn">ðŸ˜Š</button>
            <input type="text" id="msgInput" placeholder="Type a message...">
            <button id="sendBtn">Send</button>
            <input type="file" id="fileInput" style="display:none;">
        </div>
    </div>

    <div id="rightSidebar">
        <h2>Online Users</h2>
        <div id="usersList"></div>
    </div>
</div>

<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/emojionearea/3.4.1/emojionearea.min.js"></script>

<script>
document.addEventListener("DOMContentLoaded", function(){
    const firebaseConfig = {
      apiKey: "AIzaSyCwSqm65CoNwPc3PiVo1T40YJM2MAcg480",
      authDomain: "server-1-9fa4f.firebaseapp.com",
      databaseURL: "https://server-1-9fa4f-default-rtdb.firebaseio.com",
      projectId: "server-1-9fa4f",
      storageBucket: "server-1-9fa4f.firebasestorage.app",
      messagingSenderId: "1019529146427",
      appId: "1:1019529146427:web:e22f6bbe1623b528f6ec1e"
    };
    firebase.initializeApp(firebaseConfig);

    let db = firebase.database();
    let userId = "user-"+Math.floor(Math.random()*100000);
    let userName = "";
    let currentRoom = "room1";
    let tempMessages = [];
    let selecting = false;
    let selectedMessages = new Set();

    let homePage = document.getElementById("homePage");
    let enterChatBtn = document.getElementById("enterChatBtn");
    let nameInputHome = document.getElementById("nameInputHome");
    let msgInput = document.getElementById("msgInput");
    let sendBtn = document.getElementById("sendBtn");
    let chatMessages = document.getElementById("chatMessages");
    let chatTitle = document.getElementById("chatTitle");
    let roomsDiv = document.getElementById("rooms");
    let createGroupBtn = document.getElementById("createGroupBtn");
    let attachBtn = document.getElementById("attachBtn");
    let fileInput = document.getElementById("fileInput");
    let deleteAllBtn = document.getElementById("deleteAllBtn");
    let selectBtn = document.getElementById("selectBtn");
    let deleteSelectedBtn = document.getElementById("deleteSelectedBtn");

    function addMessage(content, cls, id=null, isImage=false){
        let div = document.createElement("div");
        div.className = "bubble "+cls;
        if(id) div.dataset.id=id;
        if(isImage){ let img=document.createElement("img"); img.src=content; img.className="chat-image"; div.appendChild(img); }
        else div.innerText=content;

        div.addEventListener("click", ()=>{
            if(selecting && id){
                if(div.classList.contains("selected")) { div.classList.remove("selected"); selectedMessages.delete(id); }
                else { div.classList.add("selected"); selectedMessages.add(id); }
            }
        });
        chatMessages.appendChild(div);
        chatMessages.scrollTop = chatMessages.scrollHeight;
    }

    function renderTempMessages(){ chatMessages.innerHTML=""; tempMessages.forEach((m,idx)=>{let cls=(m.user===userId)?"bubble-you":"bubble-friend"; addMessage((m.user===userId?"You":m.name)+": "+m.text,cls,idx,m.isImage); }); }

    function sendMessage(text,isImage=false){ 
        if(!text)return; 
        if(currentRoom==="room1"){ tempMessages.push({text,user:userId,name:userName,isImage}); renderTempMessages(); } 
        else { let msgRef=db.ref(currentRoom).push(); msgRef.set({text,user:userId,name:userName,time:Date.now(),isImage}); } 
        $("#msgInput").data("emojioneArea").setText('');
    }

    enterChatBtn.addEventListener("click", ()=>{
        let name = nameInputHome.value.trim(); 
        if(!name){ alert("Enter name"); return; }
        userName=name; 
        homePage.style.display="none"; 
        document.getElementById("chatApp").style.display="flex";
        $("#msgInput").emojioneArea({ pickerPosition: "top", tonesStyle: "bullet" });
        updateRooms(); listenMessages();
    });

    sendBtn.addEventListener("click", ()=> sendMessage($("#msgInput").data("emojioneArea").getText()));
    msgInput.addEventListener("keypress", e=>{ if(e.key==="Enter") sendMessage($("#msgInput").data("emojioneArea").getText()); });

});
</script>

</body>
</html>
