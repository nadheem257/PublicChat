<!DOCTYPE html>
<html>
<head>
<title>Super Chat</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{margin:0;font-family:Arial;background:#0a0f14;color:#fff;display:flex;flex-direction:column;height:100vh;}
header{padding:15px;background:#111;border-bottom:1px solid #222;font-size:18px;font-weight:bold;display:flex;justify-content:space-between;align-items:center;}
#roomsList{padding:10px;background:#0e131a;border-right:1px solid #222;width:200px;overflow-y:auto;display:none;flex-shrink:0;}
#chatArea{flex:1;display:flex;flex-direction:column;}
#messages{flex:1;padding:10px;overflow-y:auto;}
.msg{max-width:70%;margin:6px;padding:10px;border-radius:10px;display:inline-block;}
.me{background:#1f8ef1;margin-left:auto;border-bottom-right-radius:0;}
.them{background:#2c2f33;border-bottom-left-radius:0;}
#inputBar{padding:10px;display:flex;gap:10px;background:#111;}
#inputText{flex:1;padding:10px;border:none;border-radius:8px;font-size:16px;}
button{padding:10px;border:none;border-radius:8px;background:#1f8ef1;color:white;font-size:14px;cursor:pointer;transition:.2s;}
button:hover{opacity:0.8;}
.roomButton{width:100%;background:#131b26;padding:12px;margin-bottom:6px;border-radius:8px;text-align:left;}
.activeRoom{background:#1f8ef1;}
#homeScreen{position:fixed;top:0;left:0;width:100%;height:100%;background:#0a0f14;display:flex;flex-direction:column;justify-content:center;align-items:center;z-index:5;}
#homeScreen input{padding:10px;width:60%;margin-top:10px;border-radius:6px;border:none;}
.hidden{display:none;}
</style>
</head>

<body>

<!-- LOGIN SCREEN -->
<div id="homeScreen">
    <h2>Super Chat</h2>
    <input type="text" id="usernameInput" placeholder="Enter your name">
    <br>
    <button id="enterChatBtn">Enter Chat</button>
</div>

<header>
    <span id="roomName">Public Chat</span>
    <button id="toggleRoomsBtn">Rooms</button>
</header>

<div style="display:flex;flex:1;">
    <div id="roomsList"></div>

    <div id="chatArea">
        <div id="messages"></div>

        <div id="inputBar">
            <button id="selectBtn">Select</button>
            <input id="inputText" placeholder="Type a message...">
            <button id="sendBtn">Send</button>
        </div>
    </div>
</div>


<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

<script>
// ðŸ”¥ Replace with your Firebase config
const firebaseConfig = {
  apiKey: "YOUR_KEY",
  authDomain: "YOUR_APP.firebaseapp.com",
  databaseURL: "https://YOUR_APP-default-rtdb.firebaseio.com",
  projectId: "YOUR_APP",
  storageBucket: "YOUR_APP.appspot.com",
  messagingSenderId: "ID",
  appId: "APP_ID"
};
firebase.initializeApp(firebaseConfig);
let db = firebase.database();

let username = "";
let currentRoom = "Public";
let selecting = false;
let selectedMessages = [];

const homeScreen = document.getElementById("homeScreen");
const enterChatBtn = document.getElementById("enterChatBtn");
const inputText = document.getElementById("inputText");
const messagesDiv = document.getElementById("messages");
const roomsList = document.getElementById("roomsList");
const roomNameSpan = document.getElementById("roomName");
const sendBtn = document.getElementById("sendBtn");
const toggleRoomsBtn = document.getElementById("toggleRoomsBtn");
const selectBtn = document.getElementById("selectBtn");

// âœ… Enter Chat
enterChatBtn.addEventListener("click", ()=>{
    username = document.getElementById("usernameInput").value.trim();
    if(!username){ alert("Enter a name!"); return; }
    homeScreen.classList.add("hidden");
    loadRooms();
    joinRoom("Public");
});

// âœ… Toggle Rooms
toggleRoomsBtn.addEventListener("click", ()=>{
    roomsList.style.display = roomsList.style.display==="block"?"none":"block";
});

// âœ… Load Rooms
function loadRooms(){
    roomsList.innerHTML = "";
    roomsList.innerHTML += `<button class="roomButton" onclick="newRoomPrompt()">+ Create Group</button>`;
    db.ref("rooms").once("value", snap=>{
        snap.forEach(r=>{
            let name = r.key;
            let btn = document.createElement("button");
            btn.className="roomButton";
            btn.innerText=name;
            btn.onclick=()=>joinRoom(name);
            roomsList.appendChild(btn);
        });
    });
}

// âœ… Create Room
function newRoomPrompt(){
    let name=prompt("Group name?");
    if(!name) return;
    db.ref("rooms/"+name).set(true);
    loadRooms();
}

// âœ… Join Room
function joinRoom(room){
    currentRoom = room;
    roomNameSpan.innerText = room;
    messagesDiv.innerHTML = "";
    loadRooms();
    fetchMessages();
}

// âœ… Fetch Messages
function fetchMessages(){
    db.ref("messages/"+currentRoom).off();
    db.ref("messages/"+currentRoom).on("child_added", snap=>{
        let data = snap.val();
        displayMessage(data.id, data.user, data.text);
    });
}

// âœ… Display message
function displayMessage(id,user,text){
    let div = document.createElement("div");
    div.className = user===username?"msg me":"msg them";
    div.innerText = `${user}: ${text}`;
    if(selecting){
        div.onclick=()=>toggleSelect(id,div);
    }
    messagesDiv.appendChild(div);
    messagesDiv.scrollTop = 9999999;
}

// âœ… Send Message
sendBtn.addEventListener("click", sendMsg);
inputText.addEventListener("keydown", (e)=>{ if(e.key==="Enter") sendMsg(); });

function sendMsg(){
    let t = inputText.value.trim();
    if(!t) return;
    let id = Date.now();
    db.ref("messages/"+currentRoom+"/"+id).set({id:id,user:username,text:t});
    inputText.value="";
}

// âœ… Select Messages
selectBtn.addEventListener("click", ()=>{
    selecting=!selecting;
    alert(selecting?"Tap messages to select & delete":"Select mode off");
    if(!selecting) deleteSelected();
});

function toggleSelect(id,el){
    if(selectedMessages.includes(id)){
        selectedMessages = selectedMessages.filter(x=>x!==id);
        el.style.border="none";
    } else{
        selectedMessages.push(id);
        el.style.border="2px solid red";
    }
}

function deleteSelected(){
    selectedMessages.forEach(id=>{
        db.ref("messages/"+currentRoom+"/"+id).remove();
    });
    selectedMessages=[];
}
</script>
</body>
</html>
