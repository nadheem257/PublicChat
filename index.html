<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>WhatsApp-Style Chat</title>
<style>
body {
    margin:0; font-family: Arial; background:#ece5dd; display:flex; justify-content:center; align-items:center; height:100vh; overflow:hidden;
}
#chatApp {
    display:flex; width:90%; max-width:1000px; height:80%; background:#fff; border-radius:10px; box-shadow:0 5px 15px rgba(0,0,0,0.2); overflow:hidden;
}
/* Sidebar */
#sidebar {
    width:250px; background:#ededed; padding:10px; display:flex; flex-direction:column; border-right:1px solid #ccc;
}
#sidebar h2 { margin-top:0; font-size:20px; text-align:center; }
#usersList { flex:1; overflow-y:auto; margin-top:10px; font-size:16px; }
.user { padding:5px 10px; margin:3px 0; background:#fff; border-radius:5px; }
/* Chat area */
#chatArea {
    flex:1; display:flex; flex-direction:column; background:#f0f0f0;
}
#chatHeader {
    padding:15px; background:#075e54; color:white; font-size:20px; font-weight:bold;
}
#chatMessages { flex:1; padding:15px; overflow-y:auto; display:flex; flex-direction:column; }
.bubble {
    max-width:60%; padding:10px 15px; margin:5px 0; border-radius:20px; animation: fadeIn 0.3s; word-wrap: break-word; font-size:16px;
}
.bubble-you { background:#dcf8c6; align-self:flex-end; border-bottom-right-radius:0; color:#000; }
.bubble-friend { background:#fff; align-self:flex-start; border-bottom-left-radius:0; color:#000; }
#typing { font-size:14px; color:#555; margin:5px 15px; height:18px; }
/* Input */
#chatInput { display:flex; padding:10px; background:#eee; border-top:1px solid #ccc; }
#chatInput input { flex:1; padding:12px 15px; border-radius:25px; border:none; font-size:16px; margin-right:10px; }
#chatInput button { padding:12px 20px; border:none; border-radius:25px; background:#075e54; color:white; cursor:pointer; font-size:16px; transition:0.3s; }
#chatInput button:hover { background:#128c7e; }

@keyframes fadeIn { from {opacity:0; transform: translateY(10px);} to {opacity:1; transform: translateY(0);} }

/* Login overlay */
#loginOverlay {
    position:absolute; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.7); display:flex; flex-direction:column; justify-content:center; align-items:center; z-index:10;
}
#loginOverlay input { padding:12px; font-size:18px; border-radius:8px; border:none; margin-bottom:10px; width:250px; }
#loginOverlay button { padding:12px 25px; font-size:18px; border:none; border-radius:8px; background:#075e54; color:white; cursor:pointer; }
#loginOverlay button:hover { background:#128c7e; }
</style>
</head>
<body>

<div id="chatApp">
    <!-- Sidebar -->
    <div id="sidebar">
        <h2>Online</h2>
        <div id="usersList"></div>
    </div>

    <!-- Chat Area -->
    <div id="chatArea">
        <div id="chatHeader">Chat Room</div>
        <div id="chatMessages"></div>
        <div id="typing"></div>
        <div id="chatInput">
            <input id="msgInput" placeholder="Type a message...">
            <button id="sendBtn">Send</button>
        </div>
    </div>
</div>

<!-- Login Overlay -->
<div id="loginOverlay">
    <h2 style="color:white;">Enter Your Name</h2>
    <input id="nameInput" placeholder="Your name...">
    <button id="loginBtn">Join Chat</button>
</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

<script>
document.addEventListener("DOMContentLoaded", function(){
    const firebaseConfig = {
      apiKey: "AIzaSyCwSqm65CoNwPc3PiVo1T40YJM2MAcg480",
      authDomain: "server-1-9fa4f.firebaseapp.com",
      databaseURL: "https://server-1-9fa4f-default-rtdb.firebaseio.com",
      projectId: "server-1-9fa4f",
      storageBucket: "server-1-9fa4f.firebasestorage.app",
      messagingSenderId: "1019529146427",
      appId: "1:1019529146427:web:e22f6bbe1623b528f6ec1e"
    };
    firebase.initializeApp(firebaseConfig);

    let db = firebase.database();
    let room = "chat-room-1";
    let userId = "user-"+Math.floor(Math.random()*100000);
    let userName = "";
    let startTime = Date.now();
    let typingTimeout;

    // DOM
    let loginOverlay = document.getElementById("loginOverlay");
    let nameInput = document.getElementById("nameInput");
    let loginBtn = document.getElementById("loginBtn");
    let msgInput = document.getElementById("msgInput");
    let sendBtn = document.getElementById("sendBtn");
    let chatMessages = document.getElementById("chatMessages");
    let typingIndicator = document.getElementById("typing");
    let usersList = document.getElementById("usersList");

    function addMessage(text, cls){
        let div = document.createElement("div");
        div.className = "bubble "+cls;
        div.innerText = text;
        chatMessages.appendChild(div);
        chatMessages.scrollTop = chatMessages.scrollHeight;
    }

    loginBtn.addEventListener("click", ()=>{
        let name = nameInput.value.trim();
        if(!name){ alert("Enter a name"); return; }
        userName = name;
        loginOverlay.style.display = "none";
        db.ref(room+"-users/"+userId).set({name:userName});
        db.ref(room+"-users/"+userId).onDisconnect().remove();
        updateUsersList();
    });

    sendBtn.addEventListener("click", ()=>{
        let text = msgInput.value.trim();
        if(!text) return;
        db.ref(room).push({text, user:userId, name:userName, time:Date.now()});
        msgInput.value = "";
    });

    msgInput.addEventListener("input", ()=>{
        db.ref(room+"-typing").set({user:userName});
        clearTimeout(typingTimeout);
        typingTimeout = setTimeout(()=> db.ref(room+"-typing").remove(), 1000);
    });

    // Listen for new messages
    db.ref(room).orderByChild("time").startAt(startTime).on("child_added", snap=>{
        let data = snap.val();
        if(data && data.text){
            let cls = (data.user===userId) ? "bubble-you" : "bubble-friend";
            let displayName = (data.user===userId) ? "You" : data.name||"Friend";
            addMessage(displayName+": "+data.text, cls);
        }
    });

    // Typing indicator
    db.ref(room+"-typing").on("value", snap=>{
        let val = snap.val();
        if(val && val.user!==userName){
            typingIndicator.innerText = val.user+" is typing...";
        } else {
            typingIndicator.innerText = "";
        }
    });

    // Online users
    function updateUsersList(){
        db.ref(room+"-users").on("value", snap=>{
            let users = snap.val() || {};
            usersList.innerHTML = Object.values(users).map(u=>u.name).join("<br>");
        });
    }

});
</script>

</body>
</html>
