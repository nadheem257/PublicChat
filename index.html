<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Modern Firebase Chat</title>
<style>
body {
    margin:0; font-family: Arial; background:#111; color:white;
    display:flex; justify-content:center; align-items:center; height:100vh; overflow:hidden;
}
section {
    position:absolute; top:0; left:0; width:100%; height:100%;
    display:flex; flex-direction:column; justify-content:center; align-items:center;
    transition: all 0.5s ease; opacity:0; transform: translateY(50px); z-index:0;
}
section.active { opacity:1; transform: translateY(0); z-index:10; }
button { padding:12px 25px; margin-top:15px; font-size:16px; background:#222; color:white; border:none; cursor:pointer; border-radius:8px; transition:0.3s; }
button:hover { background:#0af; }
input { padding:10px; margin-top:10px; font-size:16px; border-radius:5px; border:none; width:250px; text-align:center; }

#chatContainer { display:flex; flex-direction:column; align-items:flex-start; width:350px; max-width:90%; height:400px; background:#000; border-radius:10px; padding:10px; }
#chatMessages { flex:1; width:100%; overflow-y:auto; padding-right:10px; }
.bubble { padding:8px 12px; border-radius:15px; margin:5px 0; max-width:80%; display:inline-block; animation: fadeIn 0.3s; }
.bubble-you { background:#0f0; color:#000; align-self:flex-end; border-bottom-right-radius:0; }
.bubble-friend { background:#0af; color:#fff; align-self:flex-start; border-bottom-left-radius:0; }
#chatInput { display:flex; width:100%; margin-top:10px; }
#chatInput input { flex:1; margin-right:5px; border-radius:8px; padding:8px; }
#typing { font-size:14px; color:#aaa; margin-top:5px; height:18px; }

#onlineUsers { position:absolute; top:10px; right:10px; background:#222; padding:10px; border-radius:8px; font-size:14px; max-width:150px; }
</style>
</head>
<body>

<!-- Home Page -->
<section id="homePage" class="active">
    <h1>Welcome to Modern Chat!</h1>
    <button id="enterChatBtn">Enter Chat</button>
</section>

<!-- Login Page -->
<section id="loginPage">
    <h2>Enter Your Name</h2>
    <input id="nameInput" placeholder="Your name...">
    <button id="loginBtn">Login</button>
</section>

<!-- Chat Page -->
<section id="chatPage">
    <h2>Chat Room</h2>
    <div id="chatContainer">
        <div id="chatMessages"></div>
        <div id="typing"></div>
        <div id="chatInput">
            <input id="msgInput" placeholder="Type a message...">
            <button id="sendBtn">Send</button>
        </div>
    </div>
    <div id="onlineUsers">Online:<br><span id="usersList"></span></div>
</section>

<!-- Firebase scripts -->
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

<script>
document.addEventListener("DOMContentLoaded", function() {
    // Firebase config
    const firebaseConfig = {
      apiKey: "AIzaSyCwSqm65CoNwPc3PiVo1T40YJM2MAcg480",
      authDomain: "server-1-9fa4f.firebaseapp.com",
      databaseURL: "https://server-1-9fa4f-default-rtdb.firebaseio.com",
      projectId: "server-1-9fa4f",
      storageBucket: "server-1-9fa4f.firebasestorage.app",
      messagingSenderId: "1019529146427",
      appId: "1:1019529146427:web:e22f6bbe1623b528f6ec1e"
    };
    firebase.initializeApp(firebaseConfig);

    let db = firebase.database();
    let room = "chat-room-1";

    let homePage = document.getElementById("homePage");
    let loginPage = document.getElementById("loginPage");
    let chatPage = document.getElementById("chatPage");

    let enterChatBtn = document.getElementById("enterChatBtn");
    let loginBtn = document.getElementById("loginBtn");
    let nameInput = document.getElementById("nameInput");
    let chatMessages = document.getElementById("chatMessages");
    let msgInput = document.getElementById("msgInput");
    let sendBtn = document.getElementById("sendBtn");
    let typingIndicator = document.getElementById("typing");
    let usersList = document.getElementById("usersList");

    let userName = "";
    let userId = "user-" + Math.floor(Math.random()*100000);

    // Track session start
    let startTime = Date.now();

    // Keep track of typing
    let typingTimeout;
    function showTyping(name){
        typingIndicator.innerText = name + " is typing...";
        clearTimeout(typingTimeout);
        typingTimeout = setTimeout(()=>{ typingIndicator.innerText = ""; }, 1000);
    }

    // Page transitions
    enterChatBtn.addEventListener("click", () => {
        homePage.classList.remove("active");
        loginPage.classList.add("active");
    });

    loginBtn.addEventListener("click", () => {
        let name = nameInput.value.trim();
        if(!name) { alert("Please enter your name!"); return; }
        userName = name;
        loginPage.classList.remove("active");
        chatPage.classList.add("active");
        addMessage(`Welcome ${userName}!`, "bubble-you");
        // Add self to online users
        db.ref(room + "-users/" + userId).set({name:userName});
        db.ref(room + "-users/" + userId).onDisconnect().remove();
        updateUsersList();
    });

    function addMessage(text, cls){
        let div = document.createElement("div");
        div.className = "bubble " + cls;
        div.innerText = text;
        chatMessages.appendChild(div);
        chatMessages.scrollTop = chatMessages.scrollHeight;
    }

    // Send message
    msgInput.addEventListener("input", () => {
        db.ref(room + "-typing").set({user:userName});
        setTimeout(()=> db.ref(room + "-typing").remove(), 1000);
    });

    sendBtn.addEventListener("click", () => {
        let text = msgInput.value.trim();
        if(!text) return;
        db.ref(room).push({ text, user: userId, name: userName, time: Date.now() });
        msgInput.value = "";
    });

    // Listen for messages
    db.ref(room)
      .orderByChild("time")
      .startAt(startTime)
      .on("child_added", snap => {
          let data = snap.val();
          if(data && data.text){
              let cls = (data.user === userId) ? "bubble-you" : "bubble-friend";
              let displayName = (data.user === userId) ? "You" : data.name || "Friend";
              addMessage(`${displayName}: ${data.text}`, cls);
          }
      });

    // Typing indicator
    db.ref(room + "-typing").on("value", snap => {
        let val = snap.val();
        if(val && val.user !== userName){
            showTyping(val.user);
        }
    });

    // Online users
    function updateUsersList(){
        db.ref(room + "-users").on("value", snap => {
            let users = snap.val() || {};
            usersList.innerHTML = Object.values(users).map(u=>u.name).join("<br>");
        });
    }

});
</script>

</body>
</html>
